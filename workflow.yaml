apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: cicd-smoketest-
spec:
  podGC:
    strategy: OnPodSuccess # delete pods when workflow is successful
  entrypoint: main
  serviceAccountName: argo
  # arguments:
  #   parameters:
  #   - name: git_ref_type
  #     value: branches
  #   - name: git_version
  templates:
  - name: main
    # inputs:
    #   parameters:
    #   - name: git_ref_type
    #   - name: git_version
    #   - name: upstream_repo
    #     value: quay.io/bradfordwagner/go-builder
    #   - name: upstream_tag
    #     value: 2.5.0
    dag:
      tasks:
      - name: invoke-other-builds
        arguments:
          parameters:
          - name: git_repo
            value: "{{ item.git_repo }}"
          - name: git_version
            value: "{{ item.git_version }}"
          - name: git_ref_type
            value: branches
          # - name: extra_args
          #   value: "--log"
        templateRef:
          name: flavor-git-template
          template: main
        withItems:
          - { git_repo: "https://github.com/bradfordwagner/gh-template-go-lib.git"           , git_version: main}
          - { git_repo: "https://github.com/bradfordwagner/gh-template-go-cli.git"           , git_version: main}
          - { git_repo: "https://github.com/bradfordwagner/gh-template-ansible-playbook.git" , git_version: main}
          - { git_repo: "https://github.com/bradfordwagner/gh-template-ansible-role.git"     , git_version: main}

